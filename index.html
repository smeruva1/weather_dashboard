<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Weather Dashboard</title>

    <!-- We link our html to the Bootstrap CDN -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="Assets/style.css">
</head>

<body>

    <!-- Container Div -->
    <div class="container">

        <!-- Jumbotron element -->
        <div class="jumbotron p-4 m-2">

            <!-- centered text -->
            <h1 class="text-center"><strong>Weather Dashboard</strong></h1>

        </div>

        <!-- a Bootstrap row with columns -->
        <div class="row">

            <!-- At large+ screens takes up half width (6/12) -->
            <div class="col-lg-4">
                <div class="card  p-4 m-1">
                    <div class="card-body">

                        <div>
                            <h5>Search for a city:</h5>
                            <!-- The form -->
                            <form class="searchCity" action="action_page.php">
                                <input type="text" placeholder="City.." name="search">
                                <button type="submit"><i class="fa fa-search"></i></button>
                            </form>

                        </div>
                        <br>
                        <div>
                            <h5>Search History</h5>

                            <div class="list-group">
                                <button type="button" class="list-group-item list-group-item-action">
                                    Cras justo odio
                                </button>
                                <button type="button" class="list-group-item list-group-item-action">Dapibus ac
                                    facilisis in</button>
                                <button type="button" class="list-group-item list-group-item-action">Morbi leo
                                    risus</button>
                                <button type="button" class="list-group-item list-group-item-action">Porta ac
                                    consectetur ac</button>
                                <button type="button" class="list-group-item list-group-item-action" disabled>Vestibulum
                                    at eros</button>
                            </div>


                        </div>
                    </div>
                </div>
            </div>

            <!-- At large+ screens takes up half width (6/12) -->
            <div class="col-lg-8">
                <div class="card  p-4 m-1">
                    <div class="card-body">
                        <div>
                            <div class="city_dt"> </div>
                            <div class="weather_icon"> </div>
                            <div class="temperature"></div>
                            <div class="humidity"></div>
                            <div class="wind_speed"></div>
                            <div class="uv_index"></div>

                        </div>

                        <br>

                        <div>
                            <h5>5 day history</h5>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- jQuery, javascript file for the Bootstrap's javascript file to function -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

        <!-- Bootstrap's javascript file that allows the dropdown menu to work  -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>



        <script type="text/javascript">

            //variables to store lat & lon, will be used for UV Index call
            var lat;
            var lon;

            // This is my API key
            var APIKey = "7fad945469bd442472c51b8a3ff0e8d5";

            // Here we are building the URL we need to query the database
            var queryURL = "https://api.openweathermap.org/data/2.5/weather?" +
                "q=Bujumbura,Burundi&units=imperial&appid=" + APIKey;

            // Here we run our AJAX call to the OpenWeatherMap API
            $.ajax({
                url: queryURL,
                method: "GET"
            })
                // We store all of the retrieved data inside of an object called "response"
                .then(function (response) {

                    // Log the queryURL
                    console.log(queryURL);

                    // Log the resulting object
                    console.log(response);

                    //Get todays date
                    var today = new Date();
                    var dd = today.getDate();
                    var mm = today.getMonth() + 1;
                    var yyyy = today.getFullYear();
                    today = mm + '/' + dd + '/' + yyyy;
                    console.log(today);


                    // Transfer content to HTML
                    $(".city_dt").html("<h4>" + response.name + "(" + today + ")</h4>");
                    
                    //weather icon
                    var weatherIcn = response.weather[0].icon;

                    console.log("-------------icon: " + weatherIcn);
                     $(".weather_icon").prepend('<img src="http://openweathermap.org/img/wn/'+weatherIcn+ '.png"/>');
                    //$(".city_dt").append('<img src="http://openweathermap.org/img/wn/'+weatherIcn+ '.png"/>');
                    
                    $(".temperature").text("Temperature: " + response.main.temp + "F");
                    $(".humidity").text("Humidity: " + response.main.humidity + "%");
                    $(".wind_speed").text("Wind Speed: " + response.wind.speed + "MPH");

                    lat = response.coord.lat;
                    lon = response.coord.lon;


                    // Log the data in the console as well
                    console.log("Temperature (F): " + response.main.temp);
                    console.log("Humidity: " + response.main.humidity);
                    console.log("Wind Speed: " + response.wind.speed);
                    console.log("Lot: " +response.coord.lat);
                    console.log("Lon: " + response.coord.lon);

                });

            //Second call for UV Index

            // Here we are building the URL we need to query the database
            var queryURL = "http://api.openweathermap.org/data/2.5/uvi?appid=" + APIKey +
                "&lat=-3.38&lon=29.36";
                // + lat + "&lon="+lon;
            // Here we run our AJAX call to the OpenWeatherMap API
            $.ajax({
                url: queryURL,
                method: "GET"
            })
                // We store all of the retrieved data inside of an object called "response"
                .then(function (response) {

                    // Log the queryURL
                    console.log(queryURL);

                    // Log the resulting object
                    console.log(response);

                    // Transfer content to HTML
                    $(".uv_index").text("UV Index: " + response.value);

                    // Log the data in the console as well
                    console.log("UV Index: " + response.value);

                });


        </script>
</body>

</html>